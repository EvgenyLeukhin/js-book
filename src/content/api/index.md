# API

**Application Programming Interface**. Интерфейс приложения (общее понятие реализации комплекса способа взаимодействия), клиент-серверное взаимодействие, весь доступный функционал приложения. 
Это то, с чем можно взаимодействовать, получать ответы на свои запросы. 

Набор методов, функций, классов приложения. C API могут взаимодействовать не только клиенты или API само с собой (local API), а другие API (remote API, интеграция различных API внутрь основного, proxy, адаптер-прослойка). 

API бывают открытые (общедоступные, веб-сервисы) и закрытые (недоступные).

И также клиенты могут взаимодействовать с разными API. Можно пользоваться другими уже созданными API, чтобы не создавать свой такой же. Каждый известный общедоступный API имеет свою документацию (инстукцию), но скрывает детали реализации (исходный код).

API бывает двух моделей (договоренность в построении API) REST (Representational State Transfer) или RESTful (более распространенный) и SOAP.

*Не изобретайте велосипед - пользуйтесь уже доступными API!!!*

**CRUD** - базовые операции в Rest API над её сущностьями (часть REST стандарта).

* CREATE - post-запрос
* READ - get-запрос
* UPDATE - put-запрос (обновление всех полей), patch-запрос (обновление некоторых полей)
* DELETE - delete-запрос

## Термины и определения

### Общие понятия

**Клиент** - устройство или ПО пользователя, c которого отправляются запросы к API. Для WEB клиентом чаще всего является **БРАУЗЕР**. ОС, мобильные и десктопные приложения также являются клиентом.

**Сервер** - удаленный компьютер, на котором физически расположен API, код приложения, БД. Обрабатывает запросы пользователей.

**Веб-сервер** - Программа, установленная на сервере, с помощью которой настраивается (конфигурируется) работа HTTP-запросов, почтовый прокси-сервер, домен и т.д.

* nginx (разработчик Игорь Сысоев)

* Express - веб-сервер для приложений на nodejs.

* Apache

**Хостинг-провайдер** - компания-посредник, предоставляющая возможность аренды серверов на DATA-центрах для возможности развертки приложений.

**DATA-центр** - предприятие, являюшееся узлом интернета, в котором соержится большое кол-во серверов.

**Backend-код приложения** - код, отвечающий за API, логику приложения, обработку запросов, взаимодействием с БД и т.д. Бэк для сервера.

**Frontend-код приложения** - код, отвечаюший за визуальное отображение приложения у пользователя, логику отображения приложения, посыл запросов, отрисовку ответов. Фронт для клиента.

Код бэка, фронта и БД как правило находятся на одном сервере.

**База данных (БД)** - файл, на котором храняться данные пользователей и данные приложения. Хранилище данных, которое взаимодействуется с API. Включает поля и таблицы.

**Админ-панель** - отдельное приложения для управления/мониторинга контентом приложения.

**Протокол (HTTP протокол)** - протокол передачи данных между клиентом и сервером. API, использующие веб-протокол HTTP - веб-сервисы.

**IP-адрес** - адрес компьтера или его индентификатор в виде ```192.168.1.1```. Любой введенный пользователем url конвертируется в IP-адрес DNS-сервером.

***

### Взаимодействие с API

Происходит путём связки **запрос-ответ**. Чаще всего с API взаимодействуют клиенты данного API, но также могут взаимодействовать сторонние клиенты, либо сторонние API.

**Запрос** - HTTP Request. Включает url-адрес запроса, его метод, версию HTTP протокола, заголовки (headers).

**Ответ** - HTTP Response. Ответ сервера на какой-либо запрос.

**Headers** - заголовки. Доп. данные в теле запроса. Браузер сам вставляет все необходимые поля.

Заголовки бывают:

* General (основные)

```
Request URL: https://evgenyleukhin.github.io/js-book/
Request Method: GET
Status Code: 200 
Remote Address: 185.199.109.153:443
Referrer Policy: strict-origin-when-cross-origin
```

* Request (В запросе)

```
:authority: evgenyleukhin.github.io
:method: GET
:path: /js-book/
:scheme: https
accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
accept-encoding: gzip, deflate, br
accept-language: ru-RU,ru;q=0.9,en;q=0.8,en-US;q=0.7
cache-control: no-cache
pragma: no-cache
sec-ch-ua: " Not A;Brand";v="99", "Chromium";v="96", "Google Chrome";v="96"
sec-ch-ua-mobile: ?0
sec-ch-ua-platform: "Windows"
sec-fetch-dest: document
sec-fetch-mode: navigate
sec-fetch-site: none
sec-fetch-user: ?1
upgrade-insecure-requests: 1
user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36
```

* Response (В ответе)

```
accept-ranges: bytes
access-control-allow-origin: *
age: 5
cache-control: max-age=600
content-encoding: gzip
content-length: 280
content-type: text/html; charset=utf-8
date: Tue, 04 Jan 2022 04:16:32 GMT
etag: W/"61d25ff9-19a"
expires: Tue, 04 Jan 2022 02:34:09 GMT
last-modified: Mon, 03 Jan 2022 02:31:21 GMT
permissions-policy: interest-cohort=()
server: GitHub.com
vary: Accept-Encoding
via: 1.1 varnish
x-cache: HIT
x-cache-hits: 1
x-fastly-request-id: 3af92add0e685628c68f89b4bfedd5b278265714
x-github-request-id: 478A:A6A2:5670D6:5ED84A:61D3AFC9
x-proxy-cache: MISS
x-served-by: cache-hel1410032-HEL
x-timer: S1641269793.762698,VS0,VE0
```

**Коды ответов (статусы)**

* Информационные **100 - 199**
* Успешные **200 - 299** (**200** - запрос успешно выполнен "ОК", **201** - новые объект создан "Created")
* Перенаправления **300 - 399**
* Клиентские ошибки **400 - 499** (**400** - неверный запрос "Bad Request", **401** - авторизация не прошла "Unauthorized", **404** - не найдено "Not Found")
* Серверные ошибки **500 - 599** (**500** - ошибка сервера "Internal Server Error", **505** - HTTP-версия не поддерживается "HTTP Version Not Supported")

***

Для Frontend при взаимодействии с API важно знать:

* **API_URL** - url-адрес, на котором расположена API приложения

```js
const API_URL = 'https://jsonplaceholder.typicode.com';
```

* **Эндпоинты API** - точки входа (маршруты) API, отдельные логически разделенные части API, которые обрабатывают запросы клиента. Адрес (точка входа), на который можно отправить запрос. Эндпоинты имеют пространтво имён, названия различаются по логике.

```js
// Пример эндпоинта todos
const endpoint = `${API_URL}/todos`;
```


* **Методы запросов к эндпоинтом** - название метода запроса для обращения к эндпоинту API.

**Методы запросов**

* POST
* GET
* PUT, PATCH
* DELETE

Чаще всего для документирования этих понятий использую Swagger.

**Формат данных** - формат обмена данных. Браузер "парсит" пришедший json и отображает данные.

* JSON - данные в js-объектном виде
* Protobuf (малоиспользуемый)
* XML (устаревший) - данные в виде html-разметки

**Необходимые (обязательные) поля с данными** - набор полей со значениями для корректного взаимодействия с эндпоитном API.

***


**Токен** - Уникальный id, выданный пользователю при успешной авторизации. Далее после получения, его передают при всех авторизированных запросах, чтобы его мог проверить бэкенд.

**localStorage** - Локальное хранилище прямо в браузере, в нем хранят данные об авторизации (хранят токены).

**cookies** - Тоже хранение данных только в отдельных куки-файлах. Куки помогают пользователям быстрее заходить и пользоваться сайтами. Часто хранят персональные данные, сбор статистики (контекстная реклама), настройки, предпочтения, выбранные для конкретного сайта. API проверяет наличие куки-файлов с настройками, подтягивает с них данные и отправляет на сервер, если такие куки-файлы есть. Есть уязвимость, куки-файлы могут перехватить через общедоступное WiFi подключение.

* временные куки (удаляются после закрытия браузера)
* постоянные куки (есть срок жизни, реклама)
* сторонние куки (тоже реклама)

***

### Обновление API

**Деплой** - Обновление/публикация кода приложения

**Pipeline** - Прогресс деплоя приложения

**CLI** - Управление приложением через Comand line interface

***

### Тестирование

* **[Swagger](https://swagger.io/)** - интерактивная документация по эндпоинтам API.

* **[Thunder client](https://www.thunderclient.io/)** - плагин VSCode для тестирования API (тестирование прямо из редактора).

* **[Postman](https://www.postman.com/)** - популярная программа для тестирования API.

#### Тестовые API

* [jsonplaceholder](https://jsonplaceholder.typicode.com/)

* [swapi](https://swapi.dev/)

***

### Этапы запуска приложения

1. Пользователь пишет в браузерной строке адрес сайта

2. Адрес сайта конвертируется DNS-сервером в IP-адрес сервера, на котором расположен файл index.html

3. Открывается index.html файл (это точка входа любого веб-приложения), привязянный к указанному адресу

4. index.html подтягивает (загружает) все необходимые ресурсы (стили, скрипты, шрифты, изображения и т.д.)

5. Браузер парсит html, css, js-код загруженный с сервера, в браузере клиента


